{% extends "bootstrap.html" %}
{% block body %}
{% if current_user.is_authenticated %}

<div class="container-fluid m-3">
    <div class="row justify-content-md-center">
        <p>This is the dashboard of {{ current_user.email }}.</p>
    </div>
    {% if characters %}
	    <table class="table table-hover table-striped">
	    	<caption>Your list of EVE characters</caption>
	        <thead>
	            <tr>
	                <th scope="col">Character</th>
	                <th scope="col">Actions</th>
	            </tr>
	        </thead>
	        <tbody>
	            {% for c in characters %}
	            <tr>
	                <td scope="row">
		            	<a href="{{ url_for('bs.character', character_id=c.id) }}">{{ c.name }}</a>
	                </td>
	                <td scope="row">
						<button type="button" class="btn btn-secondary"
							onclick="location.href='{{ url_for('bs.maillist', character_id=c.id) }}'">Mail</button>
						<button type="button" class="btn btn-secondary"
							onclick="location.href='{{ url_for('bs.skillqueue', character_id=c.id) }}'">Skills</button>
						<button type="button" class="btn btn-secondary showModal" data-toggle="modal"
							data-target="#rmCharModal"data-charname="{{ c.character_name }}"
							data-charid="{{ c.id }}">&times;</button>
	                </td>
	            </tr>
	            {% endfor %}
	        </tbody>
	    </table>

<div class="modal fade" id="rmCharModal" tabindex="-1" role="dialog" aria-labelledby="rmCharModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="rmCharModalLabel">Remove character</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
        <button type="button" class="btn btn-primary" id="yesPlease">Remove</button>
      </div>
    </div>
  </div>
</div>

	{% else %}
		<p>You have not added any EVE characters yet.</p>
	{% endif %}
    <div class="row justify-content-md-center">
        <a href="{{ auth_url }}"><img alt="LOG IN with EVE Online" src="static/img/eve-sso-login-black-small.png"/></a>
    </div>
</div>
{% else %}
	<p>You are not authenticated.</p>
{% endif %}
{% endblock %}

{% block javascript %}
<script type="text/javascript">
    $(function () {
        $(".showModal").click(function () {
        	var charid = $(this).data("charid");
            var msg = "Do you want to remove character " + charid + " from your dashboard?";
            msg = msg + " Associated authentication tokens will be removed from the database."
            $("#yesPlease").data("charid", charid);
            $(".modal-body").html(msg);
        })
    });
    $(function () {
    	$("#yesPlease").click(function () {
	    	var url = $(location).attr("href") + "/rm/" + $(this).data("charid");
	    	$("#rmCharModal").modal("hide");
	    	$(location).attr("href", url)
    	});
    });
</script>
{% endblock %}
